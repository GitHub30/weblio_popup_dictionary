var ctxtId=0;var ctxtTrId=0;var rUrl=new RegExp("[\r\n\t]");var pre_fav="";var onloadTime=(new Date()).getTime();var fakePostCode=fakePost.toString().replace(/(\n|\t)/gm,"");chrome.extension.onConnect.addListener(function(a,b){a.onMessage.addListener(function(d,c){var k=localStorage.fav_al+"";if(!d){if(pre_fav==k){return}}if(d.ktp&&d.ktp=="op"){window.open(chrome.extension.getURL("options.html"),"_blank");return}pre_fav=k;var e=k.split(",");var i=e[0]||"";var f=e[5]||"";var h=e[8]||"";if(i=="none"){chrome.browserAction.setIcon({path:"icon16_off.png"})}else{chrome.browserAction.setIcon({path:"icon16.png"});i=e[1]||""}var j=fetchQry("%s")||"";j=j.substring(0,Math.min(45,j.length));if(ctxtId==0&&f!="noShow"){var l="Weblio英和辞典で「"+j+"」を検索";ctxtId=chrome.contextMenus.create({type:"normal",title:l,contexts:["selection"],onclick:rdtxt})}else{if(ctxtId>0&&f=="noShow"){chrome.contextMenus.remove(ctxtId);ctxtId=0}}if(ctxtTrId==0&&h!="noShow"){var g="Weblioで「"+j+"」を翻訳";ctxtTrId=chrome.contextMenus.create({type:"normal",title:g,contexts:["selection"],onclick:rdTrtxt})}else{if(ctxtTrId>0&&h=="noShow"){chrome.contextMenus.remove(ctxtTrId);ctxtTrId=0}}c.postMessage({r_act:i,r_al:k})})});chrome.tabs.onSelectionChanged.addListener(function(a){chrome.tabs.get(a,function(b){if(b.status==="complete"&&/^(https?|file):/.test(b.url)){chrome.tabs.sendRequest(a,{tb:""},function(c){})}})});function rdtxt(d,b){var a={};var c=fetchQry(d.selectionText)||"";if(c.length>0&&c.length<100){a.url="http://ejje.weblio.jp/content/"+encodeURL(c).replace(/%2f/g,"/");chrome.tabs.create(a)}}function fakePost(e,b){document.charset="UTF-8";var d=document.createElement("form");d.setAttribute("method","post");d.setAttribute("action","http://translate.weblio.jp/");if(!e){e=""}if(!b){b=""}var f={originalText:e,lp:"EJ",tm:b};for(var c in f){var a=document.createElement("input");a.setAttribute("type","hidden");a.setAttribute("name",c);a.setAttribute("value",f[c]);d.appendChild(a)}document.body.appendChild(d);d.submit()}function rdTrtxt(e,b){var a={};var c=fetchQry(e.selectionText)||"";var d="";if(onloadTime){d=((new Date()).getTime())-onloadTime}if(_gaq){_gaq.push(["_trackEvent","click","context_menu"])}if(c.length>0){chrome.tabs.create({url:"javascript:"+fakePostCode+" fakePost('"+escapeQry(c)+"', '"+d+"');"})}}function fetchQry(a){a=a.replace(rUrl,"");a=a.replace(/^\s+/g,"");if(a.length==0||a.length>1000){return""}return a}function escapeQry(a){a=a.replace(/\r?\n/g,"");a=a.replace(/\\/g,"\\\\");a=a.replace(/"/g,'\\"');a=a.replace(/'/g,"\\'");a=a.replace(/</g,"\\x3c");a=a.replace(/>/g,"\\x3e");return a}function encodeURL(e){var f="";var a="";var d="";for(var b=0;b<e.length;b++){f=e.charAt(b);a=e.charCodeAt(b);if(a==42||a==45||a==46||a==95||((a>=48)&&(a<=57))||((a>=65)&&(a<=90))||((a>=97)&&(a<=122))){d+=f}else{if(a==32){d+="+"}else{if((a>=0)&&(a<=127)){f="0"+a.toString(16);d+="%"+f.substr(f.length-2)}else{if(a>2097151){d+="%"+(240+((a&1835008)>>18)).toString(16);d+="%"+(128+((a&258048)>>12)).toString(16);d+="%"+(128+((a&4032)>>6)).toString(16);d+="%"+(128+(a&63)).toString(16)}else{if(a>2047){d+="%"+(224+((a&61440)>>12)).toString(16);d+="%"+(128+((a&4032)>>6)).toString(16);d+="%"+(128+(a&63)).toString(16)}else{d+="%"+(192+((a&1984)>>6)).toString(16);d+="%"+(128+(a&63)).toString(16)}}}}}}return d};